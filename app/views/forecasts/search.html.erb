<%= form_with model: @search_query,
              url: search_forecasts_path,
              method: :get,
              data: {
                controller: "autocomplete",
                action: "submit->autocomplete#beforeSubmit"
              } do |f| %>
  <div class="control has-icons-right">
    <%=
      f.text_field :formatted_address,
                   id: "autocomplete",
                   class: "input is-primary",
                   placeholder: "Start typing an address...",
                   data: { autocomplete_target: "searchTerm" }
    %>
    <span class="icon is-small is-right">
      <%= icon('fa-regular', 'search') %>
    </span>

    <%= f.hidden_field :latitude, data: { autocomplete_target: "latitude" } %>
    <%= f.hidden_field :longitude, data: { autocomplete_target: "longitude" } %>

    <%= f.submit "Search", style: "display: none" %>
  </div>
<% end %>

<% if @search_query.blank? %>
  <strong>Type in address to get forecast for...</strong>
<% else %>
  <h3>
    Weather forecast for
    <%= @search_query.formatted_address %> at<br/>
    <%= @search_query.latitude %>, <%= @search_query.longitude %>
  </h3>

  <div>
    <% if @location.present? %>
      <p>
        AccuWeather location: <%= @location.id %>, <%= @location.primary_postal_code %>, <%= @location.country %>
      </p>
      <% if @condition.present? %>
        <p>
          <% if @condition.weather_icon.present? %>
            <img class="icon" src="https://developer.accuweather.com/sites/default/files/<%= "%02d" % @condition.weather_icon %>-s.png">
          <% end %>
          <%= @condition.weather_text %><br/>
          <%= @condition.is_cached %>
        </p>
      <% else %>
        No forecast found for this location.
      <% end %>
    <% else %>
      Location for the forecast can't be found.
    <% end %>
  </div>
<% end %>
